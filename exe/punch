#!/usr/bin/env ruby

require "bundler/setup"
require "punch"
require "punch/gateways"
require "punch/cli"
include Punch::CLI
include Punch::Gateways

# initialize logger in pwd
LoggerPort.gateway = Logr.new('punch.log')

BANNER = <<~EOF.freeze

 - Punch v#{Punch::VERSION} Clean Code Puncher -
 - https://github.com/nvoynov/punch

 Start by
   1. gem "punch", "~> 0.1.0", git: "https://github.com/nvoynov/punch.git"
   2. $ punch

 Usage
   $ punch new PROJECT
   $ punch init
   $ punch clone clean
   $ punch sentry NAME [PARA1 PARA2]
   $ punch entity NAME [PARA1 PARA2]
   $ punch service NAME [PARA1 PARA2]
   $ punch preview sentry|entity|service|gateway
EOF

if ARGV.empty?
  puts BANNER
  exit
end

command = ARGV.shift.downcase
case command
when 'new'   # create new punched
  create(ARGV.shift)
when 'init'  # init punch there
  init
when 'clone' # punch could be cloning some other than Clean in future
  clone(ARGV.shift)
when /(sentry|entity|service)/
  punch(ARGV.unshift(command))
when /preview/
  preview(ARGV)
else
  puts "Sorry, didn't get you"
  puts banner
end
