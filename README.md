# Punch

The Punch is a source code generator based on [Clean](https://github.com/nvoynov/clean) that is my sort of adaptation of The Clean Architecture principles.

It was born for the purpose of boosting code architecture with Clean concepts and increasing productivity by eliminating tedious work by generating source code skeletons instead of writing it manually. You can look through [User Stories](UserStories.md) for basic ideas.

Punch also plays for Clean as some kind promoter and varnisher - 1) it is an example of direct utilizing Clean's architecture, and 2) it is the first user who gives feedback.

Keep code clean, and happy punching!

## Installation

I'm still not push it to rubygems.org, so it should be installed manually

    $ git clone https://github.com/nvoynov/punch.git
    $ cd punch
    $ bundle
    $ rake install

Then you can add this line to your application's Gemfile:

```ruby
gem "punch", "~> 0.1.0", git: "https://github.com/nvoynov/punch.git"
```

And then execute:

    $ bundle install

Or you can just start punching and "punch" Gemfile :)

    $ punch new some_app

## Usage

Run `$ punch` to see its banner and get the basics

### Punching projects

To "punch" a new project run the following command

    $ punch new PROJECT

the command will create the following project structure

    <project>
    <project>/Gemfile
    <project>/Rakefile
    <project>/test
    <project>/test/test_helper

You can also start "punching" inside an empty directory

    $ mkdir punch_demo
    $ cd punch_demo
    $ punch init

and it will do actually the same as `$ punch punch_demo` except creating a directory

### Preview "in action"

Instead of writing expressive commands description here I encourage everyone to try it "in actions" at the very beginning. Just run the commands followed one by one and see over the output

    $ punch preview sentry integer "must be integer" "v.is_a?(Integer)"
    $ punch preview service create_user name email
    $ punch preview service create_user name: email:
    $ punch preview service create_user name:string email:
    $ punch preview service create_user name:string email:
    $ punch preview entity user name:string email:email
    $ punch preview entity users/user name:string email:email
    $ punch preview entity credentials email:email password:password

The `preview` command reads punched directory but does not touch existing source files; it only shows filenames and content for source files to be generated by regular `punch` command that can be useful to asses for possible changes.

### Punching sources

At first, I see an app as it has dozens services and entities, but just a few gateways sort of one data storage, and maybe a few external systems to interact. So one would rather "punch" entities and services and I deliberately refused to punch `Clean::Gateway`.

That's why the basic and only commands are `punch sentry/service/entity` those will create source files based on `Clean::Sentry`, `Clean::Service`, and `Clean::Entity` templates (see `lib/assets/erb` for templates).

That should be also mentioned that instead of having regular `punch sentry` command, I'd prefer to create it inside particular services and entities passing necessary sentry into parameters like `punch service create_user name:string` inside which will be called  `punch sentry string` and ready `MustbeString` sentry will be used inside `CreateUser` service.

__The only current problem with templates__ relates to requiring basic concepts to inherit inside punched sources. I can't guess all the possible  strategies one could prefer for storing basic concepts

- in the separated directory, like `lib/gadgets`
- together with descendants, like `lib/services/service` and `lib/services/create_user`
- straight inheriting from Clean::Service

So today it is just the `require_relative 'service'` and it should be fixed manually.

I rather prefer to create project-specific gadgets

```ruby
# lib/gadgets/service.rb
require 'clean'
require 'forwardable'

module App
  class Service < Clean::Service
    extend Forwardable
    def_delegator :StoragePort, :gateway, :storage
    def_delegator :PlayboxPort, :gateway, :playbox
    # ...
  end
end
```

### Configuration

Punch can be configured a bit through `punch.yml` configuration file that actually points directory paths to write source files.

```yaml
--- !ruby/object:Punch::Config
lib: lib
test: test
sentries: sentries
entities: entities
services: services
```

You can interpret it as "services will be placed to lib/services directory and its tests to test/services". So you can change it for `lib: app` and the service will be placed in "app/services/"

### Logging

The last thing is logger. Punch logs commands and possible exceptions inside `punch.log`

## History

This gem stands on the shoulders of [Cleon](https://github.com/nvoynov/cleon) and [Dogen](https://github.com/nvoynov/dogen), developing and systematizing their ideas, even grabbing some of their source code.

As for [Cleon](https://github.com/nvoynov/cleon), firstly, I am confused that it sort of breaks the SRP by being responsible for both data (basics sources) and behavior (code generation). Secondly, it is slightly over-engineered being requiring working folder with gem.

As for [Dogen](https://github.com/nvoynov/dogen), being a really curious idea by adding DSL, it still remains a code generator.

## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake test` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and the created tag, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and questions are welcome on GitHub at https://github.com/nvoynov/punch.

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
