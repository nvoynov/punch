<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="keywords" content="ruby, source-code-generator, interactor, service, entity, plugin, business-logic-layer, the-clean-architecture, domain-driven-design" />
  <title>Punch Introduction</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="css/styles.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p class="navbar">
<span class="smallcaps">=
<strong><code>Punch.(Domain.(DSL))</code></strong> = <a
href="readme.html">Readme</a> ~ <a href="changelog.html">Changelog</a> ~
<a href="story.html">Story</a> ~ <a href="intro.html">Intro</a> ~ <a
href="https://github.com/nvoynov/punch">Github</a></span>
</p>
<header id="title-block-header">
<h1 class="title">Punch Introduction</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#intro" id="toc-intro">Intro</a></li>
<li><a href="#basics" id="toc-basics">Basics</a>
<ul>
<li><a href="#service" id="toc-service">Service</a></li>
<li><a href="#entity" id="toc-entity">Entity</a></li>
<li><a href="#plugin" id="toc-plugin">Plugin</a></li>
<li><a href="#sentry" id="toc-sentry">Sentry</a></li>
</ul></li>
<li><a href="#app-design" id="toc-app-design">App Design</a></li>
<li><a href="#examination" id="toc-examination">Examination</a></li>
</ul>
</nav>
<h1 id="intro">Intro</h1>
<p>Playing with <a
href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">The
Clean Architecture</a> in 2021 I found it just an amazing tool, but a
bit tiresome also because of the necessity to constantly create and
require a bunch of template classes like entities and services. That was
the reason for designing Punch. I wanted just a few things</p>
<ol type="1">
<li>Design my code base by The Clean Architecture principles, so it will
be easy to write, read, test, and evolve.</li>
<li>Start as small as possible with just PORO by adopting services,
entities, and plugins, postponing particular technologies as much as
possible (CLI, Web, Message Brokers, Storage, etc.)</li>
<li>Punch (generate) services, entities, and plugins to boost
productivity and reduce mistakes by generating them instead of writing
manually.</li>
</ol>
<p>Punch provides a few basic stuff:</p>
<ol type="1">
<li>Four basic concepts - Service, Entity, Plugin, Sentry</li>
<li>source code templates for the concepts</li>
<li>CLI for punching the concepts</li>
<li>DSL to express and “punch” the domain of the concepts</li>
</ol>
<h1 id="basics">Basics</h1>
<h2 id="service">Service</h2>
<p>The crucial part and the face of any domain is a set of actors
(users) and services (use cases, interactors) provided by the domain to
the actors. This part “screams” about the domain intent.</p>
<p>Punch provides you with its own <a
href="lib/punch/basics/service.rb">basic service</a> that is used across
the Punch itself for punching concepts.</p>
<p>Regular domain service operates with business entities and other
environment-provided stuff using plugins. The service is also considered
the domain boundary and must guard the domain against wrong incoming
data. My basic domain service in 99% cases looks like this:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require_relative</span> <span class="vs">&#39;../basics&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require_relative</span> <span class="vs">&#39;../plugins&#39;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require_relative</span> <span class="vs">&#39;../sentries&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require_relative</span> <span class="vs">&#39;../entities&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span> <span class="vs">&#39;forwardable&#39;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Domain Service</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">Service</span> <span class="kw">&lt;</span> <span class="dt">Punch</span><span class="kw">::</span><span class="dt">Service</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">include</span> <span class="dt">Entities</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extend</span> <span class="dt">Forwardable</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  def_delegator <span class="wa">:PluginHolder</span>, <span class="wa">:object</span>, <span class="wa">:plugin</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The basic service will be utilized by a regular service like
this:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require_relative</span> <span class="vs">&#39;service&#39;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">CreateOrder</span> <span class="kw">&lt;</span> <span class="dt">Service</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(user_id:)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">@user_id</span> <span class="kw">=</span> <span class="dt">MustbeUUID</span><span class="kw">.</span>(user_id, <span class="wa">:user_id</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># @return [Order]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> call</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    user <span class="kw">=</span> store<span class="at">.get</span>(<span class="dt">User</span>, <span class="wa">id: </span><span class="ot">@user_id</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fail</span> <span class="dt">Failure</span>, <span class="vs">&#39;unknown user&#39;</span> <span class="cf">unless</span> user</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    order <span class="kw">=</span> <span class="dt">Order</span><span class="at">.new</span>(<span class="wa">user_id: </span><span class="ot">@user_id</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    store<span class="at">.put</span>(order)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Depending on domain purpose, it could operate with value objects
instead of entities. It is exactly the Punch case that does not operate
with any business data but uses value objects placed under Punch::Models
namespace.</p>
<p>The good name for a domain service will include actor and action,
consider names like UserCreateOrder, ManagerRejectOrder,
SystemNotifyParties, etc.</p>
<h2 id="entity">Entity</h2>
<p>The Entity represents some data record and the simplest (even
“native”) way to express such records is to use the regular Ruby 3.2
Data class</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">Order</span> <span class="kw">&lt;</span> <span class="dt">Data</span><span class="at">.define</span>(<span class="wa">:id</span>, <span class="wa">:created_at</span>, <span class="wa">:created_by</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(<span class="wa">id: </span><span class="dt">SecureRandom</span><span class="at">.uuid</span>, <span class="wa">created_at: </span><span class="dt">Time</span><span class="at">.now</span>, created_by:)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">super</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>And it is the point where the first reflection appears - should the
entity guard constructor arguments or it is the responsibility of the
appropriate service that creates the entity.</p>
<p>In regular user applications, usual flow will be the following:</p>
<ol type="1">
<li>The actor requests the service, passing required parameters</li>
<li>The service creates the entity and returns it to the actor.</li>
</ol>
<p>In such cases, the native way will be the service that guards
parameters</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">CreateOrder</span> <span class="kw">&lt;</span> <span class="dt">Service</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(user_id:)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">@user_id</span> <span class="kw">=</span> <span class="dt">MustbeUUID</span><span class="kw">.</span>(user_id, <span class="wa">:user_id</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> call</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    order <span class="kw">=</span> <span class="dt">Order</span><span class="at">.new</span>(<span class="wa">created_by: </span><span class="ot">@user_id</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    store<span class="at">.put</span>(order)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>  </span></code></pre></div>
<p>When one deals mainly with complex value objects (models, data
without identity), maybe it will be more suitable to guard model
parameters in the constructor of the model</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">Param</span> <span class="kw">&lt;</span> <span class="dt">Data</span><span class="at">.define</span>(<span class="wa">:name</span>, <span class="wa">:type</span>, <span class="wa">:desc</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(name:, type:, <span class="wa">desc: </span><span class="vs">&#39;&#39;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">MustbeStrOrSym</span><span class="kw">.</span>(name, <span class="wa">:name</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">MustbeStrOrSym</span><span class="kw">.</span>(type, <span class="wa">:type</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">MustbeStrOrSym</span><span class="kw">.</span>(desc, <span class="wa">:desc</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">super</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="dt">MustbeParamCollection</span> <span class="kw">=</span> <span class="dt">Sentry</span><span class="at">.new</span>(<span class="wa">:params</span>, <span class="vs">&#39;must be Array&lt;Param&gt;&#39;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>) <span class="kw">{|</span>v<span class="kw">|</span> v<span class="at">.is_a?</span>(<span class="dt">Array</span>) <span class="kw">&amp;&amp;</span> v<span class="at">.all?</span><span class="kw">{|</span>e<span class="kw">|</span> e<span class="at">.is_a?</span>(<span class="dt">Param</span>)<span class="kw">}</span> <span class="kw">}</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">Model</span> <span class="kw">&lt;</span> <span class="dt">Data</span><span class="at">.define</span>(<span class="wa">:name</span>, <span class="wa">:params</span>, <span class="wa">:desc</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(name:, params:, <span class="wa">desc: </span><span class="vs">&#39;&#39;</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">MustbeStrOrSym</span><span class="kw">.</span>(name, <span class="wa">:name</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">MustbeStrOrSym</span><span class="kw">.</span>(desc, <span class="wa">:desc</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">MustbeParamCollection</span><span class="kw">.</span>(params)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">super</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h2 id="plugin">Plugin</h2>
<p>A plugin represents an interface to the world outside the domain. The
real world consists of database servers, file storages, message brokers,
etc. But the interface should be tied to the domain, not to the tech
beside the real world.</p>
<p>Assuming that domain entities are stored inside some data store, one
could sketch the simples store interface like follows:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">Store</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extend</span> <span class="dt">Plugin</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># @param klass [Class]</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># @param criteria [Hash]</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># @return [Object] first :klass object matched to :criteria or nil when not found</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> get(klass, <span class="kw">**</span>criteria)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fail</span> <span class="st">&quot;</span><span class="sc">#{</span><span class="dv">self</span><span class="at">.class</span><span class="sc">}</span><span class="st">#get must be overridden&quot;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># @param obj [Object]</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># @return [Object] put object</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> put(obj)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fail</span> <span class="st">&quot;</span><span class="sc">#{</span><span class="dv">self</span><span class="at">.class</span><span class="sc">}</span><span class="st">#get must be overridden&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>  </span></code></pre></div>
<p>To bring plugins to the domain services Punch provides
“plugins.rb”</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">require_relative</span> <span class="vs">&#39;plugins/store&#39;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a> <span class="dt">StoreHolder</span> <span class="kw">=</span> <span class="dt">Store</span><span class="at">.plugin</span></span></code></pre></div>
<p>At the domain development stage there is no necessity to have and
even choose real tech behind the interface - the good practice to mock
and stub the real world for testing purpose (minitest examples of using
mock provided inside generated tests).</p>
<h2 id="sentry">Sentry</h2>
<p>The sentry is a little helper to guard the domain against wrong input
data. Domain services and entities usually share a bunch of data
primitives like UUID, email, string 256, positive integer no more than
100, etc.</p>
<p>The example of utilizing sentries placed above in <a
href="#entity">Entity</a> section.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">MustbeParamCollection</span> <span class="kw">=</span> <span class="dt">Sentry</span><span class="at">.new</span>(<span class="wa">:params</span>, <span class="vs">&#39;must be Array&lt;Param&gt;&#39;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>) <span class="kw">{|</span>v<span class="kw">|</span> v<span class="at">.is_a?</span>(<span class="dt">Array</span>) <span class="kw">&amp;&amp;</span> v<span class="at">.all?</span><span class="kw">{|</span>e<span class="kw">|</span> e<span class="at">.is_a?</span>(<span class="dt">Param</span>)<span class="kw">}</span> <span class="kw">}</span></span></code></pre></div>
<h1 id="app-design">App Design</h1>
<p>When one have working clean domain of services, entities, and plugins
the application design becomes just tech adoption and configuration
stuff. Basically, one need</p>
<ol type="1">
<li>Provide the user interface layer (CLI, Web, API, Message Broker,
etc.)</li>
<li>Implement plugin interfaces for chosen technologies (database,
external API, etc.)</li>
<li>Configure the app by assembling the app interface, services, and
plugin implementation</li>
</ol>
<p>Some first preliminary numbers shows that my apps is something about
700 SLOC Ruby with blanks and comments. And important thing is it won’t
grow further when domain grows.</p>
<h1 id="examination">Examination</h1>
<p>At this time I’ve “punched” a few simple domains and saw some
statistics at the beginning and at the end of the project (the
<code>punch stat</code> command was provided especially for the
need)</p>
<p><u>The very first demo</u> repo <a
href="https://github.com/nvoynov/punch_users.git">punch_users</a> (just
domain without app) shows:</p>
<ul>
<li>85% of sources were “punched” and 15% were created manually;</li>
<li>50% of Ruby LOC were “punched” and the other 50% were created
manually.</li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Location</th>
<th style="text-align: left;">Total</th>
<th>“Punched”</th>
<th style="text-align: left;">SLOC</th>
<th style="text-align: left;">Blank</th>
<th style="text-align: left;">Comments</th>
<th>Net Ruby LOC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lib</td>
<td style="text-align: left;">23 (17)</td>
<td>13 (13)</td>
<td style="text-align: left;">657 (329)</td>
<td style="text-align: left;">102 (53)</td>
<td style="text-align: left;">175 (93)</td>
<td>380 (183)</td>
</tr>
<tr class="even">
<td style="text-align: left;">test</td>
<td style="text-align: left;">17 (17)</td>
<td>15 (16)</td>
<td style="text-align: left;">363 (335)</td>
<td style="text-align: left;">46 (38)</td>
<td style="text-align: left;">45 (150)</td>
<td>272 (147)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lib + test</td>
<td style="text-align: left;">40 (34)</td>
<td>28 (29)</td>
<td style="text-align: left;">1020 (664)</td>
<td style="text-align: left;">148 (91)</td>
<td style="text-align: left;">220 (243)</td>
<td>652 (330)</td>
</tr>
</tbody>
</table>
<p><u>The next demo</u> repo <a href=""></a> with a few app interfaces
and plugins</p>
<p><u>One of the real project</u> statistics .. unfortunately have no
stat just after punching domain</p>
<p>“scc app” shows how small the app really is (3200 for domain and 700
for app!)</p>
<pre><code>Language                 Files     Lines   Blanks  Comments     Code Complexity
───────────────────────────────────────────────────────────────────────────────
Ruby                         9       710       82       124      504         35</code></pre>
<p>punch status a bit polluted test by tech plugins test</p>
<pre><code>Looking through &#39;lib&#39;, &#39;test&#39; directories..

- 85 sources, 52 &quot;punched&quot; (4 remain &quot;punched&quot;)
- 3178 SLOC, 458 blank and 617 comment lines

&#39;lib&#39; summary:
- 39 sources, 25 &quot;punched&quot; (0 remain &quot;punched&quot;)
- 1349 SLOC, with 198 blank lines and 413 comments

&#39;test&#39; summary:
- 46 sources, 27 &quot;punched&quot; (4 remain &quot;punched&quot;)
- 1829 SLOC, with 260 blank lines and 204 comments

remain &quot;punched&quot;:
- test/ba.../entities/test_device.rb
- test/ba.../entities/test_target.rb
- test/ba.../services/test_user_query_drivers.rb
- test/ba.../services/test_user_query_targets.rb</code></pre>
<div id="footer">
<hr />
<p>© 2023-2024 <a href="http://nvoynov.github.io/">nvoynov</a></p>
</div>
</body>
</html>
